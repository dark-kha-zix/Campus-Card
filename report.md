# 校园卡管理项目设计

| 学号 | 姓名 |
| :---: | :----: |
| 17307003 | 陈宏辉 |
| 18324061 | 文君逸 |

## 流程图

![流程图](./images/流程图.png)

## UML类图

![UML](./images/UML.png)

## 类间关系

### 学生与卡的绑定

在设计的时候通过两个全局变量**vector\<Student\> students**与**vector\<Card\> cards** 来保存所有已创建的学生和校园卡，将校园卡卡号与学生学号设为相同，利用卡号**card_id**和学号**stu_id**来建立学生和校园卡间的一一映射关系。

### 学生请求校园卡服务

在**Student**类中提供了一系列服务接口，例如查询、充值、消费等等，这些方法会先找到该学生对应的校园卡，然后调用**Card**类中相应的方法，对对应的**Card**实例化的对象进行操作，即对校园卡本身进行操作。对应的操作封装在**Card**类中，操作的条件判断也在**Card**类的方法中进行，在不满足条件的时候将不予执行并输出对应的错误原因。

## 权限选择

在一开始系统启动的界面会提供两种模式：管理员模式和学生模式。

### 管理员模式

管理员可以创建学生并为学生绑定上校园卡，初始密码默认置为和学号相同。如果在输入学号后检测到相同学号的学生已经存在，则不允许继续输入后续的学生信息，若不存在则可继续录入学生的其他信息。    
因为管理员模式只有一个创建学生的功能，因此执行完上述功能后管理员模式会自动退出，返回模式选择界面。

### 学生模式

如果选择学生模式，学生需要输入其校园卡卡号和密码。无论是卡号不存在，还是卡号密码不匹配，都会自动退回到模式选择界面。如果匹配之后，会跳转到学生服务界面，学生可以在该界面选择一系列校园卡的服务，包括充值、消费、查看记录、挂失等等。    
学生可以在请求完服务后退出学生模式，系统会给出提示信息并返回模式选择界面。     

## 部分代码实现说明

### 消费、充值记录

对于这个功能我们需要记录两个信息

+ 时间
+ 消费金额

因此我们先定义了一个结构体变量 

``` C++
typedef struct record {
	time_t now;
	double amount;
} record;
```

用来记录这两个信息。以充值为例，在学生的每一次充值动作后，都会记录当前时间和金额，并记录到对应校园卡的**vector**容器中去。实现代码如下：

``` C++
this->_remain += amount;
record tmp;
tmp.now = time(0);
tmp.amount = amount;
_charge.emplace_back(tmp);
```

### 命令行交互界面

这一部分我们主要采用**switch-case**语句来提供功能选择，并在一开始的**help**界面中显示每一个命令对应的功能选择，在用户输入非法命令的时候报出错误信息并再次显示出**help**界面。输入命令的时候用户还可根据命令行的提示来确定自己当前是在模式选择界面还是在某种模式下。

## 系统测试